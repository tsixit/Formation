---
# Bootstraping
- hosts: all
  name: Bootstraping des vms
  tasks:
    - name: Vérification de l'absence du fichier OOaptproxy
      file:
        path: /etc/apt/apt.conf.d/00aptproxy
        state: absent
    - name: Installation serveur ssh
      apt:
        name: openssh-server
        state: present
    - name: Démarrer le service sshd et  démarrer au boot
      service:
        name: sshd
        state: started
        enabled: 'yes'
        # enabled permet de démarrer le service au boot
    - name: Déploiement clé ssh pour root
      copy:
        src: key/serverkey.pub
        dest: /root/.ssh/authorized_keys
        mode: 0600
        owner: root
        group: root
    - name: Garantir le fichier /etc/motd
      copy:
        dest: /etc/motd
        content: "Ce système est géré par Ansible"
        owner: root
        group: root
